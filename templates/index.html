<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Greenhouse Automation Dashboard</title>
    <link href="https://stackpath.bootstrapcdn.com/bootswatch/4.5.2/darkly/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/solarized-dark.css">
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script type="module">
        import {
            initTimeUpdater,
            initMotorSwitches,
            fetchMotorStatuses,
            handleSetTimeForm,
            fetchSensorData
        } from './static/js/domManager.js';

        window.onload = function() {
            initTimeUpdater();
            initMotorSwitches();
            handleSetTimeForm();
            fetchSensorData();
            setInterval(fetchMotorStatuses, 5000); // Fetch motor statuses every 5 seconds
        };
    </script>
</head>

<body>

<div class="container mt-5">
    <h1 class="text-center mb-5">Greenhouse Automation Dashboard</h1>

    <!-- Current Status and Readings -->
    <div class="jumbotron">
        <h2>Current Status</h2>
        <p><strong>Current Time:</strong> <span id="current-time">Loading...</span></p>
        <p><strong>Roll Up Time:</strong> <span id="roll-up-time">Loading...</span></p>
        <p><strong>Roll Down Time:</strong> <span id="roll-down-time">Loading...</span></p>
        <p><strong>Temperature:</strong> <span id="temperature">Loading...</span></p>
        <p><strong>Humidity:</strong> <span id="humidity">Loading...</span></p>
        <p><strong>VPD:</strong> <span id="vpd">Loading...</span></p>
        <!-- Add more environmental sensor data here as needed -->
    </div>

    <!-- Manual Controls -->
    <div class="mb-5">
        <h2>Manual Controls</h2>
        <!-- Manual override Motor Control buttons -->
        <button class="btn btn-primary motor-control-btn" data-action="roll_up" data-motor-id="1">Roll Up Motor 1</button>
        <button class="btn btn-primary motor-control-btn" data-action="roll_down" data-motor-id="1">Roll Down Motor 1</button>
        <!-- Add buttons for other motors as needed -->
        <button class="btn btn-danger motor-control-btn" data-action="stop_motors">Stop All Motors</button>

        <h4>Motor Control On/Off</h4>
        <div class="custom-control custom-switch">
            <input type="checkbox" class="custom-control-input" id="sidewall-left-switch">
            <label class="custom-control-label" for="sidewall-left-switch">Sidewall Left</label>
        </div>
        <!-- Add switches for other motors as needed -->
    </div>

    <!-- Time Settings -->
    <div>
        <h2>Set Time for Motor Actions</h2>
        <form id="set-time-form">
            <div class="form-group">
                <label for="roll_up_time">Roll Up Time:</label>
                <input type="time" id="roll_up_time" name="roll_up_time" class="form-control" required>
            </div>
            <div class="form-group">
                <label for="roll_down_time">Roll Down Time:</label>
                <input type="time" id="roll_down_time" name="roll_down_time" class="form-control" required>
            </div>
            <button type="submit" class="btn btn-success">Set Times</button>
        </form>
    </div>
</div>

<!-- WebSocket for UI control locally hosted in static/js/socket.io.js -->
<script src="{{ url_for('static', filename='js/socket.io.js') }}"></script>

</body>
</html>
